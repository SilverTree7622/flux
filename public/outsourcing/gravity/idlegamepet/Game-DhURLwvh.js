var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{a as i}from"./networkPlugin-Bwiiz7BK.js";class s extends Phaser.GameObjects.Container{constructor(e,i,s){super(e,i??0,s??0),t(this,"ripple_efx"),t(this,"img_finger"),t(this,"finger_container"),t(this,"touch_area"),t(this,"fingerTw",null),t(this,"rippleTw",null),t(this,"isEnable",!1),t(this,"initScale",1),t(this,"bubbleUI"),t(this,"bubbleEvtCallback",(()=>{})),this.scaleX=1.5,this.scaleY=1.5;const h=e.add.container(0,0);h.scaleX=2,h.scaleY=2,this.add(h);const l=e.add.ellipse(0,0,128,128);l.isFilled=!0,h.add(l);const a=e.add.image(29,38,"img_finger");a.angle=-32.00000000000006,h.add(a);const n=e.add.rectangle(0,0,3200,3200);n.alpha=1e-5,n.isFilled=!0,this.add(n),this.ripple_efx=l,this.img_finger=a,this.finger_container=h,this.touch_area=n,this.init(),this.addTouchAreaEvt()}touchTw(){this.ripple_efx.setAlpha(0),this.startFingerAnimation()}setEnable(e){this.isEnable=e,this.bubbleUI&&(e?this.bubbleUI.show():this.bubbleUI.hide())}bindBubbleNEvt(e,t){this.bubbleUI=e,this.bubbleEvtCallback=t??(()=>{})}init(){this.setVisible(!1),this.initScale=this.finger_container.scaleX}addTouchAreaEvt(){this.touch_area.setInteractive(),this.touch_area.on("pointerup",(()=>{this.isEnable&&(this.scene.sound.play("SND_Button_Common"),this.bubbleEvtCallback(),this.bubbleUI&&this.bubbleUI.hide(),this.scene.tweens.addCounter({from:1,to:0,duration:250,ease:"Power2",onUpdate:e=>{this.setAlpha(e.getValue()??0)},onComplete:()=>{this.setVisible(!1),this.setAlpha(0),this.stopFingerAnimation()}}))}))}startFingerAnimation(){this.setVisible(!0),this.stopFingerAnimation(),this.fingerTw=this.scene.tweens.add({targets:this.img_finger,scale:1.3,duration:300,ease:"Power2",yoyo:!0,repeat:-1,onRepeat:()=>{this.playRippleEffect(),this.scene.sound.play("guide_finger_sfx")}})}stopFingerAnimation(){this.fingerTw&&(this.fingerTw.stop(),this.fingerTw.destroy(),this.fingerTw=null),this.img_finger.setScale(1)}playRippleEffect(){this.rippleTw&&(this.rippleTw.stop(),this.rippleTw.destroy()),this.ripple_efx.isFilled=!1,this.ripple_efx.setScale(.1),this.ripple_efx.setAlpha(1),this.ripple_efx.setStrokeStyle(16,16777215),this.rippleTw=this.scene.tweens.addCounter({from:0,to:1,duration:1e3,ease:"Power2",onUpdate:e=>{const t=e.getValue();if(!t)return;const i=.1+2.9*t;this.ripple_efx.setScale(i);const s=1-t;this.ripple_efx.setAlpha(s);const h=16-15*t;this.ripple_efx.setStrokeStyle(Math.max(1,h),16777215)}})}}class h extends Phaser.GameObjects.Text{constructor(e,i,s){super(e,i??0,s??0,"",{}),t(this,"bubbleGraphics",null),t(this,"_bubbleWidth",240),t(this,"_bubbleHeight",240),t(this,"_bubbleRadius",16),this.text="bubble default text",this.setStyle({align:"center",color:"#000000ff",fontFamily:"Roboto",fontSize:"60px",fontStyle:"bold"}),this.init(),this.bubbleWidth=240,this.bubbleHeight=240}init(){var e;this.drawBubble(),this.setDepth(1e3),this.setVisible(!1),null==(e=this.bubbleGraphics)||e.setVisible(!1)}set bubbleWidth(e){this._bubbleWidth=e,this.drawBubble()}get bubbleWidth(){return this._bubbleWidth}set bubbleHeight(e){this._bubbleHeight=e,this.drawBubble()}get bubbleHeight(){return this._bubbleHeight}hide(){var e;this.setAlpha(1),null==(e=this.bubbleGraphics)||e.setAlpha(1),this.scene.tweens.add({targets:[this,this.bubbleGraphics],duration:250,ease:"Power2",alpha:0,onComplete:()=>{var e;this.setVisible(!1),null==(e=this.bubbleGraphics)||e.setVisible(!1)}})}show(){var e,t;this.setAlpha(0),null==(e=this.bubbleGraphics)||e.setAlpha(0),this.setVisible(!0),null==(t=this.bubbleGraphics)||t.setVisible(!0),this.scene.tweens.add({targets:[this,this.bubbleGraphics],duration:750,ease:"Power2",alpha:1})}drawBubble(){var e;const t=(null==(e=this.bubbleGraphics)?void 0:e.visible)??!1;this.bubbleGraphics&&this.bubbleGraphics.destroy();const i=this._bubbleWidth,s=this._bubbleHeight,h=this._bubbleRadius,l=Math.max(2,Math.min(8,h/4)),a=Math.max(.3,Math.min(.7,.5+(h-16)/32)),n=this.scene.add.graphics({x:this.x,y:this.y});this.bubbleGraphics=n,this.bubbleGraphics.setVisible(t),n.fillStyle(2236962,a),n.fillRoundedRect(l,l,i,s,h),n.fillStyle(16777215,1),n.lineStyle(4,5658198,1),n.strokeRoundedRect(0,0,i,s,h),n.fillRoundedRect(0,0,i,s,h);const o=Math.floor(i/7),r=Math.floor(40),b=Math.floor(32),d=o-r/2,c=s,p=o+r/2,u=s,g=o,_=Math.floor(s+b);n.lineStyle(4,2236962,a),n.lineBetween(p-1,u+l,g+2,_),n.fillTriangle(d,c,p,u,g,_),n.lineStyle(2,5658198,1),n.lineBetween(p,u,g,_),n.lineBetween(d,c,g,_),this.updateTextPosition()}updateTextPosition(){const e=this;e.setWordWrapWidth(this._bubbleWidth-20);const t=e.getBounds();e.setPosition(this.x+this._bubbleWidth/2-t.width/2,this.y+this._bubbleHeight/2-t.height/2)}}class l extends Phaser.Scene{constructor(){super("Game"),t(this,"fight_video"),t(this,"fight_con"),t(this,"rabbit_slot"),t(this,"mira_slot"),t(this,"eagle_slot"),t(this,"centipede_slot"),t(this,"mushroom_slot"),t(this,"pet_select_con"),t(this,"guideFingerUI"),t(this,"speechBubbleUI"),t(this,"pet_select_slot_list"),t(this,"video_fight_source_list",["gravity-idlegame-pet-rabbit-fight-short","gravity-idlegame-pet-mira-fight-short","gravity-idlegame-pet-eagle-fight-short","gravity-idlegame-pet-centipede-fight-short","gravity-idlegame-pet-mushroom-fight-short"])}editorCreate(){const e=this.add.container(0,0),t=this.add.video(450,800,"gravity-idlegame-pet-centipede-fight-short");e.add(t);const i=this.add.container(0,0),l=this.add.image(450,800,"pet_select_ui");i.add(l);const a=this.add.rectangle(121,723,128,128);a.alpha=.001,a.isFilled=!0,i.add(a);const n=this.add.rectangle(281,725,128,128);n.alpha=.001,n.isFilled=!0,i.add(n);const o=this.add.rectangle(437,724,128,128);o.alpha=.001,o.isFilled=!0,i.add(o);const r=this.add.rectangle(596,723,128,128);r.alpha=.001,r.isFilled=!0,i.add(r);const b=this.add.rectangle(756,722,128,128);b.alpha=.001,b.isFilled=!0,i.add(b);const d=new s(this,132,730);this.add.existing(d),d.angle=-5;const c=new h(this,-49,272);this.add.existing(c),c.text="동반 출전할 펫을 선택하세요!",c.setStyle({});const p=[a,n,o,r,b];c.bubbleWidth=800,c.bubbleHeight=120,this.fight_video=t,this.fight_con=e,this.rabbit_slot=a,this.mira_slot=n,this.eagle_slot=o,this.centipede_slot=r,this.mushroom_slot=b,this.pet_select_con=i,this.guideFingerUI=d,this.speechBubbleUI=c,this.pet_select_slot_list=p,this.events.emit("scene-awake")}adNetworkSetup(){i(this.scene)}create(){this.adNetworkSetup(),this.editorCreate(),this.events.on("sleep",this.onSceneSleep,this),this.events.on("wake",this.onSceneWake,this),this.sound.play("170",{volume:1,loop:!0});const e=this.add.particles(0,0,"FX_Star_Big2_128",{lifespan:500,speed:{min:150,max:250},scale:{start:.3,end:0},rotate:{min:0,max:360},alpha:{start:1,end:0},gravityY:100,blendMode:"ADD",tint:16056192,emitting:!1});this.input.on("pointerup",(t=>{this.sound.play("SND_Button_Common"),e.emitParticleAt(t.x,t.y,6),this.createCircleEffect(t.x,t.y),this.createRippleEffect(t.x,t.y)})),this.bindFingerNBubbleUI(),setTimeout((()=>{this.guideFingerUI.setEnable(!0),this.guideFingerUI.touchTw(),this.bindPetSelectSlot()}),200)}update(){}bindFingerNBubbleUI(){this.guideFingerUI.bindBubbleNEvt(this.speechBubbleUI,(()=>{}))}bindPetSelectSlot(){this.pet_select_slot_list.map(((e,t)=>{e.setInteractive(),e.on("pointerup",(()=>{this.sound.play("SND_Button_Common");const e=this.sound.get("170");e.pause(),this.pet_select_con.setVisible(!1),this.fight_con.setVisible(!0),this.fight_video.changeSource(this.video_fight_source_list[t]),this.fight_video.play(),this.fight_video.on("complete",(()=>{this.scene.start("Download"),e.resume()}))}))}))}onSceneSleep(){}onSceneWake(){}createCircleEffect(e,t){const i=this.add.graphics();i.setDepth(1e3),i.lineStyle(6,16056192,1),i.strokeCircle(0,0,20),i.setPosition(e,t),this.tweens.add({targets:i,scaleX:2,scaleY:2,alpha:0,duration:300,ease:"Power2",onComplete:()=>{i.destroy()}})}createRippleEffect(e,t){const i=this.add.graphics();i.setDepth(1e3),i.lineStyle(1,16056192,.8),i.strokeCircle(0,0,10),i.setPosition(e,t),this.tweens.add({targets:i,scaleX:8,scaleY:8,alpha:0,duration:600,ease:"Power2",onComplete:()=>{i.destroy()}})}shutdown(){this.events.off("sleep",this.onSceneSleep,this),this.events.off("wake",this.onSceneWake,this)}}export{l as default};
