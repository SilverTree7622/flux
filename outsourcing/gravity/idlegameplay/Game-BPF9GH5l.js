var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{a as i}from"./networkPlugin-Bwiiz7BK.js";class s extends Phaser.GameObjects.Container{constructor(e,i,s){super(e,i??0,s??0),t(this,"ripple_efx"),t(this,"img_finger"),t(this,"finger_container"),t(this,"touch_area"),t(this,"fingerTw",null),t(this,"rippleTw",null),t(this,"isEnable",!1),t(this,"initScale",1),t(this,"evtCallback",(()=>{}));const n=e.add.container(0,0);n.scaleX=2,n.scaleY=2,this.add(n);const r=e.add.ellipse(0,0,128,128);r.isFilled=!0,n.add(r);const a=e.add.image(29,38,"img_finger");a.angle=-32.00000000000006,n.add(a);const h=e.add.rectangle(0,0,3200,3200);h.alpha=1e-5,h.isFilled=!0,this.add(h),this.ripple_efx=r,this.img_finger=a,this.finger_container=n,this.touch_area=h,this.init(),this.addTouchAreaEvt()}touchTw(){this.ripple_efx.setAlpha(0),this.startFingerAnimation()}setEnable(e){this.isEnable=e}bindEvt(e){this.evtCallback=e??(()=>{})}fadeOut(){this.scene.sound.play("SND_Button_Common"),this.scene.tweens.addCounter({from:1,to:0,duration:250,ease:"Power2",onUpdate:e=>{this.setAlpha(e.getValue())},onComplete:()=>{this.setVisible(!1),this.setAlpha(0),this.stopFingerAnimation()}})}init(){this.setVisible(!1),this.initScale=this.finger_container.scaleX}addTouchAreaEvt(){this.touch_area.setInteractive(),this.touch_area.on("pointerup",(()=>{this.isEnable&&(this.evtCallback(),this.fadeOut())}))}startFingerAnimation(){this.setVisible(!0),this.stopFingerAnimation(),this.fingerTw=this.scene.tweens.add({targets:this.img_finger,scale:1.3,duration:300,ease:"Power2",yoyo:!0,repeat:-1,onRepeat:()=>{this.playRippleEffect(),this.scene.sound.play("guide_finger_sfx")}})}stopFingerAnimation(){this.fingerTw&&(this.fingerTw.stop(),this.fingerTw.destroy(),this.fingerTw=null),this.img_finger.setScale(1)}playRippleEffect(){this.rippleTw&&(this.rippleTw.stop(),this.rippleTw.destroy()),this.ripple_efx.isFilled=!1,this.ripple_efx.setScale(.1),this.ripple_efx.setAlpha(1),this.ripple_efx.setStrokeStyle(16,16777215),this.rippleTw=this.scene.tweens.addCounter({from:0,to:1,duration:1e3,ease:"Power2",onUpdate:e=>{const t=e.getValue(),i=.1+2.9*t;this.ripple_efx.setScale(i);const s=1-t;this.ripple_efx.setAlpha(s);const n=16-15*t;this.ripple_efx.setStrokeStyle(Math.max(1,n),16777215)}})}}class n extends Phaser.Scene{constructor(){super("Game"),t(this,"play_video_ins"),t(this,"guideFingerUI_play"),t(this,"play_con"),t(this,"player_select_img"),t(this,"right_rect"),t(this,"left_rect"),t(this,"guideFingerUI_right"),t(this,"guideFingerUI_left"),t(this,"select_con"),t(this,"white_bg"),t(this,"story_intro_img"),t(this,"guideFingerUI"),t(this,"intro_con"),t(this,"videoPauseTimeline",[{maleTime:7,femaleTime:6,callback:()=>{this.guideFingerUI_play.bindEvt((()=>{this.guideFingerUI_play.setEnable(!1),this.removeTimeline(),this.play_video_ins.resume()})),this.guideFingerUI_play.setEnable(!0),this.guideFingerUI_play.touchTw()}}]),t(this,"isMale",!0),t(this,"currentIntroStep",0),t(this,"introTextures",[]),t(this,"isIntroComplete",!1),t(this,"introAutoTimer")}editorCreate(){const e=this.add.container(0,0),t=this.add.video(450,800,"gravity-idlegame-play-male-fight");e.add(t);const i=new s(this,162,227);e.add(i);const n=this.add.container(0,0),r=this.add.image(450,800,"player_select_ui");n.add(r);const a=this.add.rectangle(450,800,450,1600);a.setOrigin(0,.5),a.alpha=1e-4,a.isFilled=!0,a.fillColor=7895160,n.add(a);const h=this.add.rectangle(450,800,450,1600);h.setOrigin(1,.5),h.alpha=1e-4,h.isFilled=!0,h.fillColor=7895160,n.add(h);const o=new s(this,530,1410);n.add(o);const l=new s(this,370,1410);n.add(l);const d=this.add.container(0,0);d.visible=!1;const c=this.add.rectangle(450,800,900,1600);c.isFilled=!0,d.add(c);const p=this.add.image(450,800,"story_intro_1");p.scaleX=2,p.scaleY=2,d.add(p);const g=new s(this,609,927);d.add(g),this.play_video_ins=t,this.guideFingerUI_play=i,this.play_con=e,this.player_select_img=r,this.right_rect=a,this.left_rect=h,this.guideFingerUI_right=o,this.guideFingerUI_left=l,this.select_con=n,this.white_bg=c,this.story_intro_img=p,this.guideFingerUI=g,this.intro_con=d,this.events.emit("scene-awake")}adNetworkSetup(){i(this.scene)}create(){this.adNetworkSetup(),this.editorCreate(),this.events.on("sleep",this.onSceneSleep,this),this.events.on("wake",this.onSceneWake,this),this.sound.play("main_bgm",{volume:1,loop:!0});const e=this.add.particles(0,0,"FX_Star_Big2_128",{lifespan:500,speed:{min:150,max:250},scale:{start:.3,end:0},rotate:{min:0,max:360},alpha:{start:1,end:0},gravityY:100,blendMode:"ADD",tint:16056192,emitting:!1});this.input.on("pointerup",(t=>{this.sound.play("SND_Button_Common"),e.emitParticleAt(t.x,t.y,6),this.createCircleEffect(t.x,t.y),this.createRippleEffect(t.x,t.y)})),this.createIntro()}update(){this.updateVideo4Pause()}createIntro(){this.select_con.setVisible(!1),this.intro_con.setVisible(!0),this.white_bg.setVisible(!0),this.story_intro_img.setAlpha(0),this.story_intro_img.setVisible(!0),this.guideFingerUI.setEnable(!1),this.currentIntroStep=0,this.introTextures=["story_intro_1","story_intro_2","story_intro_3"],this.isIntroComplete=!1,this.showIntroStep()}showIntroStep(){if(this.currentIntroStep>=this.introTextures.length)return;const e=this.introTextures[this.currentIntroStep];this.story_intro_img.setTexture(e),this.story_intro_img.setAlpha(0),this.tweens.add({targets:this.story_intro_img,alpha:1,duration:750,onComplete:()=>{this.currentIntroStep===this.introTextures.length-1?this.showGuideFinger():(this.story_intro_img.setInteractive(),this.story_intro_img.once("pointerup",(()=>{this.nextIntroStep()})),this.introAutoTimer=this.time.delayedCall(1500,(()=>{this.isIntroComplete||this.nextIntroStep()})))}})}showGuideFinger(){this.isIntroComplete=!0,setTimeout((()=>{this.guideFingerUI.setEnable(!0),this.guideFingerUI.bindEvt((()=>{this.guideFingerUI.setEnable(!1),this.tweens.add({targets:this.story_intro_img,alpha:0,duration:1500,onComplete:()=>{this.intro_con.setVisible(!1),this.story_intro_img.setVisible(!1),this.createSelect()}})})),this.guideFingerUI.touchTw()}),300)}nextIntroStep(){this.introAutoTimer&&(this.introAutoTimer.destroy(),this.introAutoTimer=void 0),this.story_intro_img.disableInteractive(),this.story_intro_img.off("pointerup"),this.tweens.add({targets:this.story_intro_img,alpha:0,duration:750,onComplete:()=>{this.currentIntroStep++,this.showIntroStep()}})}createSelect(){const e=this.player_select_img.width*(1600/this.player_select_img.height);this.player_select_img.setDisplaySize(e,1600),this.guideFingerUI_left.bindEvt((()=>{this.guideFingerUI_left.setEnable(!1),this.guideFingerUI_right.setEnable(!1),this.guideFingerUI_right.fadeOut()})),this.guideFingerUI_right.bindEvt((()=>{this.guideFingerUI_left.setEnable(!1),this.guideFingerUI_right.setEnable(!1),this.guideFingerUI_left.fadeOut()})),this.guideFingerUI_left.setEnable(!0),this.guideFingerUI_right.setEnable(!0),this.guideFingerUI_left.touchTw(),setTimeout((()=>{this.guideFingerUI_right.touchTw()}),300),this.select_con.setVisible(!0),this.left_rect.setInteractive(),this.left_rect.once("pointerup",(()=>{this.createPlay(!0)})),this.right_rect.setInteractive(),this.right_rect.once("pointerup",(()=>{this.createPlay(!1)}))}createPlay(e){this.guideFingerUI_play.setEnable(!1),this.isMale=e,this.select_con.setVisible(!1),this.play_video_ins.changeSource(e?"gravity-idlegame-play-male-fight":"gravity-idlegame-play-female-fight"),this.play_video_ins.setPlaybackRate(.75),this.play_video_ins.setVisible(!0),this.play_con.setVisible(!0),this.play_video_ins.on("play",(()=>{const e=this.play_video_ins.width*(1600/this.play_video_ins.height);this.play_video_ins.setDisplaySize(e,1600)})),this.play_video_ins.play(),this.play_video_ins.on("complete",(()=>{this.scene.start("Download")}))}updateVideo4Pause(){var e,t;if(!this.play_con.visible)return;if(!this.play_video_ins.isPlaying())return;if(0===this.videoPauseTimeline.length)return;const i=this.isMale?this.videoPauseTimeline[0].maleTime:this.videoPauseTimeline[0].femaleTime;i<=this.play_video_ins.getCurrentTime()&&(this.play_video_ins.pause(),this.play_video_ins.setCurrentTime(i),null==(t=(e=this.videoPauseTimeline[0]).callback)||t.call(e))}removeTimeline(){this.videoPauseTimeline.splice(this.videoPauseTimeline.indexOf(this.videoPauseTimeline[0]),1)}onSceneSleep(){}onSceneWake(){}createCircleEffect(e,t){const i=this.add.graphics();i.setDepth(1e3),i.lineStyle(6,16056192,1),i.strokeCircle(0,0,20),i.setPosition(e,t),this.tweens.add({targets:i,scaleX:2,scaleY:2,alpha:0,duration:300,ease:"Power2",onComplete:()=>{i.destroy()}})}createRippleEffect(e,t){const i=this.add.graphics();i.setDepth(1e3),i.lineStyle(1,16056192,.8),i.strokeCircle(0,0,10),i.setPosition(e,t),this.tweens.add({targets:i,scaleX:8,scaleY:8,alpha:0,duration:600,ease:"Power2",onComplete:()=>{i.destroy()}})}shutdown(){this.events.off("sleep",this.onSceneSleep,this),this.events.off("wake",this.onSceneWake,this)}}export{n as default};
